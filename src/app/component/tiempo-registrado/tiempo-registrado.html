<div class="card-title card">
  <h4>
    <span class="text-primary">Overtime MP</span>
    <span class="text-secondary"> / Tiempo suplementario reportados</span>
  </h4>
</div>

<div class="card table-card mt-3">
  <div class="table-header">
    <div class="filters">

      <!-- Filtros de fecha: agrupar inicio/fin en fila -->
      <!-- Filtro Fecha Inicio -->
      <div class="fecha-group">
        <div class="filter-item">
          <div class="form-floating custom-floating">
            <input matInput [matDatepicker]="pickerInicio" class="form-control border-info" id="fechaInicio"
              name="fechaInicio" placeholder="dd/mm/aaaa" [(ngModel)]="fechaInicio" (ngModelChange)="onFechaChange()"
              (click)="openPicker('inicio', pickerInicio)" (focus)="openPicker('inicio', pickerInicio)" [min]="minDate"
              [max]="maxDate" aria-label="Fecha inicio" />
            <label for="fechaInicio">*Fecha Inicio</label>
            <mat-datepicker-toggle matSuffix [for]="pickerInicio" (click)="openPicker('inicio', pickerInicio)">
              <mat-icon (click)="openPicker('inicio', pickerInicio)">calendar_today</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #pickerInicio [calendarHeaderComponent]="CustomDatepickerHeader"
              [startAt]="startAt"></mat-datepicker>
          </div>
        </div>
        <div class="filter-item">
          <div class="form-floating custom-floating">
            <input matInput [matDatepicker]="pickerFin" class="form-control border-info" id="fechaFin" name="fechaFin"
              placeholder="dd/mm/aaaa" [(ngModel)]="fechaFin" (ngModelChange)="onFechaChange()"
              (click)="openPicker('fin', pickerFin)" (focus)="openPicker('fin', pickerFin)" [min]="minDate"
              [max]="maxDate" aria-label="Fecha fin" />
            <label for="fechaFin">*Fecha Fin</label>
            <mat-datepicker-toggle matSuffix [for]="pickerFin" (click)="openPicker('fin', pickerFin)">
              <mat-icon (click)="openPicker('fin', pickerFin)">calendar_today</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #pickerFin [calendarHeaderComponent]="CustomDatepickerHeader"
              [startAt]="startAt"></mat-datepicker>
          </div>
        </div>
      </div>
      <!--Btn limpiar-->
      <button type="button" class="btn btn-primary" (click)="limpiarFechas()">
        Limpiar
      </button>
    </div>
  </div>

  <div class="loading-container" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>

  <table mat-table matSort [dataSource]="dataSource" class="table mat-elevation-z0"
    *ngIf="!isLoading && dataSource.filteredData && dataSource.filteredData.length > 0">
    <!-- Cantidad de horas -->
    <ng-container matColumnDef="cantidadHoras">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Cantidad de horas </th>
      <td mat-cell *matCellDef="let element"> {{ element.cantidadHorasDisplay || (element.cantidadHoras |
        number:'1.2-2') }} </td>
    </ng-container>

    <!-- Tipo de Hora -->
    <ng-container matColumnDef="tipoHora">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo de Hora </th>
      <td mat-cell *matCellDef="let element"> {{ element.tipoHora }} </td>
    </ng-container>

    <!-- Fecha Inicio -->
    <ng-container matColumnDef="fechaHoraInicio">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Fecha Inicio </th>
      <td mat-cell *matCellDef="let element"> {{ element.fechaHoraInicio | date:'dd/MM/yyyy hh:mm a' }} </td>
    </ng-container>

    <!-- Fecha Fin -->
    <ng-container matColumnDef="fechaHoraFin">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Fecha Fin </th>
      <td mat-cell *matCellDef="let element"> {{ element.fechaHoraFin | date:'dd/MM/yyyy hh:mm a' }} </td>
    </ng-container>

    <!-- Estado Jefe -->
    <ng-container matColumnDef="estadoJefe">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Estado Jefe </th>
      <td mat-cell *matCellDef="let element">
        <span class="badge" [ngClass]="{
            'badge-success': element.estadoJefe === 'Aprobado',
            'badge-danger': element.estadoJefe === 'Rechazado',
            'badge-warning': element.estadoJefe === 'Pendiente'
          }">{{ element.estadoJefe }}</span>
      </td>
    </ng-container>

    <!-- Estado GH -->
    <ng-container matColumnDef="estadoGh">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Estado GH </th>
      <td mat-cell *matCellDef="let element">
        <span class="badge" [ngClass]="{
            'badge-success': element.estadoGh === 'Aprobado',
            'badge-danger': element.estadoGh === 'Rechazado',
            'badge-warning': element.estadoGh === 'Pendiente'
          }">{{ element.estadoGh }}</span>
      </td>
    </ng-container>

    <!-- Estado Pago -->
    <ng-container matColumnDef="estadoPago">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Estado Pago </th>
      <td mat-cell *matCellDef="let element">
        <span class="badge" [ngClass]="{
          'badge-success': element.estadoPago === 'Aprobado',
          'badge-danger': element.estadoPago === 'Rechazado',
          'badge-warning': element.estadoPago === 'Pendiente' 
        }">{{ element.estadoPago }}</span>
      </td>
    </ng-container>
    <!-- Acciones -->
    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef> Acciones </th>
      <td mat-cell *matCellDef="let element" class="acciones-cell">
        <i class="bi bi-eye action-icon" title="Ver" role="button" (click)="openVer(element)"></i>
        <i class="bi bi-pencil action-icon" title="Editar" role="button"
          (click)="((element.estadoJefe || '')?.toString().toLowerCase() !== 'pendiente' || (element.estadoGh || '')?.toString().toLowerCase() !== 'pendiente') ? null : openEditar(element)"
          [attr.aria-disabled]="(element.estadoJefe || '')?.toString().toLowerCase() !== 'pendiente' || (element.estadoGh || '')?.toString().toLowerCase() !== 'pendiente'"
          [class.disabled-action]="(element.estadoJefe || '')?.toString().toLowerCase() !== 'pendiente' || (element.estadoGh || '')?.toString().toLowerCase() !== 'pendiente'"
          [title]="((element.estadoJefe || '')?.toString().toLowerCase() !== 'pendiente' || (element.estadoGh || '')?.toString().toLowerCase() !== 'pendiente') ? 'No puede editarse: Estados Jefe/GH no son Pendiente' : 'Editar'"></i>
        <i class="bi bi-trash action-icon text-danger" title="Eliminar" role="button"
          (click)="confirmAndDelete(element)"
          [attr.aria-disabled]="(element.estadoJefe || '').toString().toLowerCase() !== 'pendiente'"
          [class.disabled-action]="(element.estadoJefe || '').toString().toLowerCase() !== 'pendiente'"
          [title]="(element.estadoJefe || '').toString().toLowerCase() !== 'pendiente' ? 'No puede eliminarse: Estado Jefe no es Pendiente' : 'Eliminar'"></i>
      </td>
    </ng-container>
    <!-- Paginador -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <div class="table-footer" *ngIf="resultsLength > 0">
    <mat-paginator [length]="resultsLength" [pageSizeOptions]="[10, 30, 50]" aria-label="Paginador"></mat-paginator>
  </div>

  <!-- Mensaje cuando no hay resultados dentro del rango de fecha seleccionado -->
  <div class="no-results-container"
    *ngIf="!isLoading && dataSource.filteredData && dataSource.filteredData.length === 0 && fechaInicio && fechaFin">
    <div class="no-results-message">
      No hay solicitudes en este per√≠odo
    </div>
  </div>
</div>
<custom-datepicker-header *ngIf="false"></custom-datepicker-header>